<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lab 5: Creating and interpreting a life table • WILD3810</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Lab 5: Creating and interpreting a life table">
<meta property="og:description" content="WILD3810">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">WILD3810</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2021.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/syllabus.html">
    <span class="fas fa-book"></span>
     
    Syllabus
  </a>
</li>
<li>
  <a href="../articles/schedule.html">
    <span class="fas fa-calendar"></span>
     
    Schedule
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-file-pdf-o"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Lecture0/Lecture0.html">Lecture 0: Introduction to WILD3810</a>
    </li>
    <li>
      <a href="../articles/Lecture1/Lecture1.html">Lecture 1: Introduction to population ecology</a>
    </li>
    <li>
      <a href="../articles/Lecture2/lecture2.html">Lecture 2: Abundance</a>
    </li>
    <li>
      <a href="../articles/Lecture3/lecture3.html">Lecture 3: Density-independent population growth</a>
    </li>
    <li>
      <a href="../articles/Lecture4/Lecture4.html">Lecture 4: Stochasticity</a>
    </li>
    <li>
      <a href="../articles/Lecture5/Lecture5.html">Lecture 5: Density-dependent population growth</a>
    </li>
    <li>
      <a href="../articles/Lecture6/lecture6.html">Lecture 6: Dynamics of small populations</a>
    </li>
    <li>
      <a href="../articles/Lecture7/Lecture7.html">Lecture 7: Life tables</a>
    </li>
    <li>
      <a href="../articles/Lecture8/Lecture8.html">Lecture 8: Survival estimation</a>
    </li>
    <li>
      <a href="../articles/Lecture9/Lecture9.html">Lecture 9: Reproduction</a>
    </li>
    <li>
      <a href="../articles/Lecture10/Lecture10.html">Lecture 10: Matrix population models</a>
    </li>
    <li>
      <a href="../articles/Lecture11/Lecture11.html">Lecture 11: Stage-structured populations</a>
    </li>
    <li>
      <a href="../articles/Lecture12/Lecture12.html">Lecture 12: Reproductive value, sensitivity, and elasticity</a>
    </li>
    <li>
      <a href="../articles/Lecture13/Lecture13.html">Lecture 13: Life history variation</a>
    </li>
    <li>
      <a href="../articles/Lecture14/Lecture14.html">Lecture 14: Metapopulation dynamics</a>
    </li>
    <li>
      <a href="../articles/Lecture15/Lecture15.html">Lecture 15: Metapopulation dynamics II</a>
    </li>
    <li>
      <a href="../articles/Lecture16/Lecture16.html">Lecture 16: Source-sink dynamics</a>
    </li>
    <li>
      <a href="../articles/Lecture17/Lecture17.html">Lecture 17: Interspecific interactions</a>
    </li>
    <li>
      <a href="../articles/Lecture18/Lecture18.html">Lecture 18: Interspecific interactions: Predation</a>
    </li>
    <li>
      <a href="../articles/Lecture19/Lecture19.html">Lecture 19: Interspecific interactions: Predation, part II</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fas fa-desktop"></span>
     
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/lab0.html">Lab 0a: Introduction to R and R Markdown</a>
    </li>
    <li>
      <a href="../articles/rmarkdown_intro.html">Lab 0b: Introduction to R Markdown</a>
    </li>
    <li>
      <a href="../articles/lab1.html">Lab 1: Introduction to R (cont.)/Abundance estimation</a>
    </li>
    <li>
      <a href="../articles/lab2.html">Lab 2: Introduction to R/Modeling population growth</a>
    </li>
    <li>
      <a href="../articles/lab3.html">Lab 3: Modeling population growth (continued)</a>
    </li>
    <li>
      <a href="../articles/lab4.html">Lab 4: Population viability analysis</a>
    </li>
    <li>
      <a href="../articles/lab5_life_tables.html">Lab 5: Creating and interpreting a life table</a>
    </li>
    <li>
      <a href="../articles/lab6_matrix_models.html">Lab 6: Modeling population dynamics using matrix projection models</a>
    </li>
    <li>
      <a href="../articles/lab7_tree_harvest.html">Lab 7: Applications of matrix population models - Sustainable tree harvest</a>
    </li>
    <li>
      <a href="../articles/lab8_metapopulation_dynamics.html">Lab 8: Metapopulation dynamics</a>
    </li>
    <li>
      <a href="../articles/lab9_source-sink.html">Lab 9: Source-sink dynamics</a>
    </li>
    <li>
      <a href="../articles/lab10_competition.html">Lab 10: Competition</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/homework.html">
    <span class="fas fa-pencil-square-o"></span>
     
    Assignments
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Lab 5: Creating and interpreting a life table</h1>
            <h3 class="subtitle">WILD3810: Plant and animal populations</h3>
                        <h4 class="author">Spring 2021</h4>
            
      
      
      <div class="hidden name"><code>lab5_life_tables.Rmd</code></div>

    </div>

    
    
<p>In this lab, you will use the birth and death information you collected last week at the cemetery to develop a life table to citizens of Logan, UT. Rather than build a single life table using all of the data, you will divide the data into smaller groups based on each individual’s sex and the time period that they lived. This will allow you to learn about how patterns of survivorship differ between males and females and how those patterns have changed over time.</p>
<p>This lab will help get you started on how to build the life table from the cemetery data. You will then complete the exercise as part of this week’s homework assignment. If you complete the entire assignment during lab, that is fine. Otherwise, you will need to complete the assignment on your own.</p>
<hr>
<p><strong>Objectives</strong></p>
<ul>
<li><p>Build a static life table from birth and death information</p></li>
<li><p>Explore how patterns of survivorship differ among males and females</p></li>
<li><p>Explore how patterns of survivorship have changed across time</p></li>
<li><p>Practice subsetting data frames in <code>R</code> using <code><a href="https://dplyr.tidyverse.org/reference/filter.html">dplyr::filter()</a></code> and bracket notation</p></li>
<li><p>Practice adding data to a data frame using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> and <code>for</code> loops</p></li>
<li><p>Practice vizualing data using <code>ggplot2</code></p></li>
</ul>
<hr>
<div id="set-up" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up" class="anchor"></a>Set up</h1>
<ol style="list-style-type: decimal">
<li><p>Log in to R Studio Cloud</p></li>
<li><p>Create a new project called <code>LastnameFirstname-Lab5</code></p></li>
</ol>
<hr>
<p><strong>Note</strong>: You will use the homework 5 template to complete the rest of this lab activity. You can copy the code below to your assignment template to start the assignment. However, you <strong>do not</strong> need to copy code the prints objects, only the code the creates or manipulates the objects.</p>
<hr>
<div id="reading-in-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#reading-in-the-data" class="anchor"></a>Reading in the data</h2>
<p>All of the birth and death data you collected last week has been compiled and included as a data frame in the <code>WILD3810</code> package. You can read the data by copying the following lines to the first chunk in your homework 5 template (note, you do not need to copy the <code><a href="https://rdrr.io/r/utils/head.html">head(lt_data)</a></code> line to your homework):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">WILD3810</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"lt_data"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lt_data</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">byear</th>
<th align="right">dyear</th>
<th align="left">sex</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1834</td>
<td align="right">1905</td>
<td align="left">Male</td>
</tr>
<tr class="even">
<td align="right">1871</td>
<td align="right">1958</td>
<td align="left">Male</td>
</tr>
<tr class="odd">
<td align="right">1822</td>
<td align="right">1916</td>
<td align="left">Male</td>
</tr>
<tr class="even">
<td align="right">1875</td>
<td align="right">1965</td>
<td align="left">Male</td>
</tr>
<tr class="odd">
<td align="right">1859</td>
<td align="right">1874</td>
<td align="left">Male</td>
</tr>
<tr class="even">
<td align="right">1866</td>
<td align="right">1905</td>
<td align="left">Male</td>
</tr>
</tbody>
</table>
</div>
<div id="adding-age-at-death" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-age-at-death" class="anchor"></a>Adding age at death</h2>
<p>The <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> function shows the first 6 rows the <code>lt_data</code> object, allowing us to see that there are 3 columns:</p>
<ul>
<li><p><code>byear</code>: The birth year of each individual</p></li>
<li><p><code>dyear</code>: The death year of each individual</p></li>
<li><p><code>sex</code>: Whether the entry corresponds to a male or female</p></li>
</ul>
<p>To build the life table, we will need at least one more piece of information <span class="math inline">\(-\)</span> age at death. We can roughly estimate age at death as <code>dyear - byear</code> (for the most accurate ages we would want to include day and month in this calculation but just using year will be accurate enough for our purposes).</p>
<p>Fortunately <code>R</code> makes it easy to calculate age at death with a single line of code. Remember that the <code>dplyr</code> function <code>mutate</code> is used to add a new column to a data frame. We give <code>mutate</code> the name of the data frame we want to add a column to, the name of the new column, and the values for the new column.</p>
<p>Copy the following line of code into your homework 5 file and the complete it to create the new variable:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="va">lt_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">lt_data</span>, age <span class="op">=</span> <span class="op">)</span></code></pre></div>
</div>
<div id="checking-the-data-for-accuracy" class="section level2">
<h2 class="hasAnchor">
<a href="#checking-the-data-for-accuracy" class="anchor"></a>Checking the data for accuracy</h2>
<p>It is almost assured that mistakes will occur during data entry <span class="math inline">\(-\)</span> typos are an inevitable part of transfering data from field sheets to digital files. Whenever you are working with raw data, you should <em>always</em> check the data to see if there are any obvious mistakes. For example, we know that age at death has to be a positive number. Use the following code to make a histogram of the age data and see if there are any negative values:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">lt_data</span><span class="op">$</span><span class="va">age</span><span class="op">)</span></code></pre></div>
<p><img src="lab5_life_tables_files/figure-html/unnamed-chunk-5-1.png" width="576"></p>
<p>Oops, looks like there are a few negative values. These are most likely due to typos in the data entry <span class="math inline">\(-\)</span> for example entering <code>1952</code> instead of <code>1852</code> for the birth year. At this stage, we have two options: modify the correct entries or remove them. To modify the entries, we need to be very sure that we know the correct values or else we just creating a different type of “wrong” data. Because we have a lot of data to work with (removing 3 entries won’t have a big impact on our conclusions), we will simply remove the individuals with negative ages. To that, we’ll use our old friend <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code>. Copy the following line into your homework and complete the missing arguments:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lt_data</span>, <span class="op">)</span></code></pre></div>
</div>
<div id="subsetting-the-cohorts" class="section level2">
<h2 class="hasAnchor">
<a href="#subsetting-the-cohorts" class="anchor"></a>Subsetting the cohorts</h2>
<p>One purpose of this lab is to examine how survivorship differs between males and females and how survivorship has changed over time. That means we need to subset the data frame to create new data frames that contain only the demographic data for the individuals in each cohort.</p>
<p>To look at changes over time, we’ll divide the data into individuals that died before 1901, individuals that died between 1901 and 1945, and individuals that died after 1945. For each of these time periods, we’ll look at the data for males and females separately. To make the subsetting easier, let’s create a vector with the cutoff years for each cohort. Copy the following code into your homework file:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cohort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1900</span>, <span class="fl">1945</span><span class="op">)</span></code></pre></div>
<p>Now we can create new data frames, one for each group, using the <code>filter</code> function. For example, we can subset the data for females that died before 1901 using:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">lt_data</span>, <span class="va">sex</span> <span class="op">==</span> <span class="st">"Female"</span> <span class="op">&amp;</span> <span class="va">dyear</span> <span class="op">&lt;=</span> <span class="va">cohort</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<p>Make sure you understand what this function is doing. <code>filter</code> requires the original data frame we want to filter, in this case <code>lt_data</code>. Then we provide conditional statements (statements that return <code>TRUE</code> or <code>FALSE</code> for each individual) that determine how we want to filter the data. In this case, we want females (<code>sex == "Female"</code>. Remember that when you ask <code>R</code> is something is equal to something else you need to use the double equal signs!) <strong>and</strong> (<code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code>) death year less than 1901 (<code>dyear &lt;= cohort[1]</code>). Remember that <code>cohort[1]</code> will return the first value of the cohort object, in this case <code>1900</code>. We can death years that are less than or equal to (<code><a href="https://rdrr.io/r/base/Comparison.html">&lt;=</a></code>) this value.</p>
<p>In your homework assignment file, modify the above to create data frames called <code>f2</code>, <code>f3</code>, <code>m1</code>, <code>m2</code>, and <code>m3</code> that contain the demographic data for males and females from the other cohorts.</p>
</div>
<div id="building-a-life-table" class="section level2">
<h2 class="hasAnchor">
<a href="#building-a-life-table" class="anchor"></a>Building a life table</h2>
<p>Now you’re ready to build a life table for each group. This lab document will walk you through building a life table for the a single cohort. You will then make the remaining life tables on your own.</p>
<p>We will start by making an empty life table and then filling in the correct values for each column. This data frame needs to define the age classes for the life table and contain the appropriate life table columns. For this analysis, we’ll use 10-year age classes (e.g., 0-9, 10-19, 20-29, etc) and define separate columns for the minimum and maximum age the correspond to each row:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="st">"Female"</span>,
                    cohort <span class="op">=</span> <span class="st">"pre-1900"</span>,
                    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, 
                    min.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">0</span>, to <span class="op">=</span> <span class="fl">110</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,
                    max.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">9</span>, to <span class="op">=</span> <span class="fl">119</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">lt_f1</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="left">cohort</th>
<th align="right">class</th>
<th align="right">min.age</th>
<th align="right">max.age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">2</td>
<td align="right">10</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">4</td>
<td align="right">30</td>
<td align="right">39</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">5</td>
<td align="right">40</td>
<td align="right">49</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">6</td>
<td align="right">50</td>
<td align="right">59</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">69</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">8</td>
<td align="right">70</td>
<td align="right">79</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">9</td>
<td align="right">80</td>
<td align="right">89</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">10</td>
<td align="right">90</td>
<td align="right">99</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">11</td>
<td align="right">100</td>
<td align="right">109</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">12</td>
<td align="right">110</td>
<td align="right">119</td>
</tr>
</tbody>
</table>
<p>Here, we use the <code><a href="https://rdrr.io/r/base/seq.html">seq()</a></code> function to create a sequence of numbers corresponding to either the minimum or maximum age for each class. We also use the <code>by</code> argument to tell the function to make the sequence by 10’s (i.e., 0, 10, 20, etc.). We also add columns to keep track of which group this life table corresponds to.</p>
<p>As we learned in lecture, the static life table starts with three main columns:</p>
<ul>
<li><p><span class="math inline">\(\large a_x\)</span> - the number of deaths within each age class</p></li>
<li><p><span class="math inline">\(\large N_x\)</span> - the number of individuals that start out alive in each age class</p></li>
<li><p><span class="math inline">\(\large l_x\)</span> - the proportion of individuals surviving to each age class</p></li>
</ul>
<p>We will use <code>mutate</code> to add empty columns for each of these variables to the life table:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">lt_f1</span>, ax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">lt_f1</span><span class="op">)</span><span class="op">)</span>,
                       Nx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">integer</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">lt_f1</span><span class="op">)</span><span class="op">)</span>,
                       lx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">lt_f1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">lt_f1</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="left">cohort</th>
<th align="right">class</th>
<th align="right">min.age</th>
<th align="right">max.age</th>
<th align="right">ax</th>
<th align="right">Nx</th>
<th align="right">lx</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">2</td>
<td align="right">10</td>
<td align="right">19</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">29</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">4</td>
<td align="right">30</td>
<td align="right">39</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">5</td>
<td align="right">40</td>
<td align="right">49</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">6</td>
<td align="right">50</td>
<td align="right">59</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">69</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">8</td>
<td align="right">70</td>
<td align="right">79</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">9</td>
<td align="right">80</td>
<td align="right">89</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">10</td>
<td align="right">90</td>
<td align="right">99</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">11</td>
<td align="right">100</td>
<td align="right">109</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">12</td>
<td align="right">110</td>
<td align="right">119</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Both the <code>integer</code> and <code>numeric</code> functions create empty vectors that can store either integer values or numeric values. We need to tell <code>R</code> how long those vectors are using the <code>length</code> argument. In this case, we know the length of the vectors needs to equal the number of rows in the data frame.</p>
<p>Now we’re ready to fill in the values for each column. The first values of <span class="math inline">\(N_x\)</span> and <span class="math inline">\(l_x\)</span> are relatively straightforward. We know that the <code>f1</code> dataframe contains one row for each individual in the cohort. That means that we start with <code><a href="https://rdrr.io/r/base/nrow.html">nrow(f1)</a></code> individuals:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">f1</span><span class="op">)</span></code></pre></div>
<p>We also know that <span class="math inline">\(l_1\)</span> always equals 1:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span><span class="op">$</span><span class="va">lx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></code></pre></div>
<p>How do we fill in <span class="math inline">\(a_1\)</span>? We need to know how many individuals died between the ages of 0 and 9. There are many ways to estimate this but we’ll use a combination of two functions you are already familiar with: <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> and <code>nrow</code>.</p>
<p>First, we can filter the <code>f1</code> data frame to contain only individuals that died between the ages of 0 and 9. Instead of writing <code>0</code> and <code>9</code> by hand, we’ll use the <code>min.age</code> and <code>max.age</code> columns in the data frame (you’ll see why in a minute):</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">age</span> <span class="op">&gt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">min.age</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">max.age</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">byear</th>
<th align="right">dyear</th>
<th align="left">sex</th>
<th align="right">age</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1864</td>
<td align="right">1864</td>
<td align="left">Female</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1873</td>
<td align="right">1874</td>
<td align="left">Female</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1871</td>
<td align="right">1871</td>
<td align="left">Female</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1895</td>
<td align="right">1896</td>
<td align="left">Female</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1871</td>
<td align="right">1878</td>
<td align="left">Female</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
<p>Now many individuals is this? Since there is one row each individual, <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> will give us the correct number. We can nest the <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> function inside of <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code> to get the number of individuals with a single line of code:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span><span class="op">$</span><span class="va">ax</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">age</span> <span class="op">&gt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">min.age</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">max.age</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now let’s think through how to get the second row filled in. <strong>Do not copy this code into your homework. We’ll use this to think through how to fill in the remaining years, then create a more automated way of completing these tasks</strong>.</p>
<p>We know that <span class="math inline">\(N_2 = N_1 - a_1\)</span> (the number of individuals that survive to the second age class is equal to the number that started in age-class 1 minus the individuals that died while in the first age-class). So:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">ax</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<p>We also know that <span class="math inline">\(l_2 = \frac{N_2}{N_1}\)</span>, so:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span><span class="op">$</span><span class="va">lx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre></div>
<p>And:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lt_f1</span><span class="op">$</span><span class="va">ax</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">age</span> <span class="op">&gt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">min.age</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">max.age</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We <em>could</em> copy these lines for each age class (2,3,…,12) and change the index number each time. But that’s a lot of work and we’ll probably make mistakes. So instead, we’ll use a <code>for</code> loop:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">lt_f1</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="co">## Nx for class i as a function of Nx and ax in the previous class</span>
  <span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">ax</span><span class="op">[</span><span class="va">i</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
  
  <span class="co">## lx for class i as a function of Nx[i] and Nx[1]</span>
  <span class="va">lt_f1</span><span class="op">$</span><span class="va">lx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="va">lt_f1</span><span class="op">$</span><span class="va">Nx</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
  
  <span class="co">## ax for class i based on the min.age and max.age values in row i</span>
  <span class="va">lt_f1</span><span class="op">$</span><span class="va">ax</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">age</span> <span class="op">&gt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">min.age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span> <span class="va">age</span> <span class="op">&lt;=</span> <span class="va">lt_f1</span><span class="op">$</span><span class="va">max.age</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">lt_f1</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">sex</th>
<th align="left">cohort</th>
<th align="right">class</th>
<th align="right">min.age</th>
<th align="right">max.age</th>
<th align="right">ax</th>
<th align="right">Nx</th>
<th align="right">lx</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">9</td>
<td align="right">5</td>
<td align="right">28</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">2</td>
<td align="right">10</td>
<td align="right">19</td>
<td align="right">1</td>
<td align="right">23</td>
<td align="right">0.8214</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">29</td>
<td align="right">2</td>
<td align="right">22</td>
<td align="right">0.7857</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">4</td>
<td align="right">30</td>
<td align="right">39</td>
<td align="right">1</td>
<td align="right">20</td>
<td align="right">0.7143</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">5</td>
<td align="right">40</td>
<td align="right">49</td>
<td align="right">0</td>
<td align="right">19</td>
<td align="right">0.6786</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">6</td>
<td align="right">50</td>
<td align="right">59</td>
<td align="right">3</td>
<td align="right">19</td>
<td align="right">0.6786</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">7</td>
<td align="right">60</td>
<td align="right">69</td>
<td align="right">5</td>
<td align="right">16</td>
<td align="right">0.5714</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">8</td>
<td align="right">70</td>
<td align="right">79</td>
<td align="right">6</td>
<td align="right">11</td>
<td align="right">0.3929</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">9</td>
<td align="right">80</td>
<td align="right">89</td>
<td align="right">5</td>
<td align="right">5</td>
<td align="right">0.1786</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">10</td>
<td align="right">90</td>
<td align="right">99</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0000</td>
</tr>
<tr class="odd">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">11</td>
<td align="right">100</td>
<td align="right">109</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0000</td>
</tr>
<tr class="even">
<td align="left">Female</td>
<td align="left">pre-1900</td>
<td align="right">12</td>
<td align="right">110</td>
<td align="right">119</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0.0000</td>
</tr>
</tbody>
</table>
<p>Hopefully now you see why we didn’t hard code the age class values when calculating <span class="math inline">\(a_x\)</span>! By using the <code>min.age</code> and <code>max.age</code> columns, we can change the values in each loop instead of having to type them by hand each time.</p>
<div id="visualizing-the-survivorship-curve" class="section level3">
<h3 class="hasAnchor">
<a href="#visualizing-the-survivorship-curve" class="anchor"></a>Visualizing the survivorship curve</h3>
<p>With the life table created, we can use <code>ggplot2</code> to plot the survivorship curve for this cohort. Add the following line to the first figure chunk in your homework assignent (look for the chuck that says <code>Enter figure code here</code>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lt_f1</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">lx</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_line</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1</span>, to <span class="op">=</span> <span class="fl">12</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="lab5_life_tables_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
<p>Notice that we can convert <span class="math inline">\(l_x\)</span> into <span class="math inline">\(log(l_x)\)</span> within the <code>ggplot</code> function.</p>
</div>
</div>
<div id="completing-the-assignment" class="section level2">
<h2 class="hasAnchor">
<a href="#completing-the-assignment" class="anchor"></a>Completing the assignment</h2>
<p>Use the code created above to complete the assignment for the remaining groups. You will be able to copy and reuse most of the code above, just be careful to go through and change the names of objects and any parts of the code that refer to specific cohort attributes (male/female, dates, etc.).</p>
<p>When you have completed the assignment, <strong>upload the .html and .Rmd files</strong> to Canvas.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Clark Rushing.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
